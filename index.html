<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corridor - Urban Hub onder het Viaduct van Gentbrugge</title>
    <!-- Clean deployment -->
    <link rel="icon" type="image/png" href="/public/LogoCorridor.png">
    <link rel="apple-touch-icon" href="/public/LogoCorridor.png">
    <!-- Tailwind CSS CDN (development only - for production use PostCSS/Tailwind CLI) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Fredoka', cursive;
        }
        
        .parallax-layer {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            will-change: transform;
        }
        
        .graffiti-text {
            text-shadow: 3px 3px 0px rgba(0,0,0,0.1);
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        
        .gradient-bg {
            background: linear-gradient(180deg, 
                rgba(255, 182, 193, 0.4) 0%,
                rgba(255, 200, 189, 0.4) 10%,
                rgba(255, 218, 185, 0.4) 20%,
                rgba(255, 236, 185, 0.4) 30%,
                rgba(255, 255, 186, 0.4) 40%,
                rgba(220, 255, 193, 0.4) 50%,
                rgba(186, 255, 201, 0.4) 60%,
                rgba(186, 240, 228, 0.4) 70%,
                rgba(186, 225, 255, 0.4) 80%,
                rgba(203, 205, 255, 0.4) 90%,
                rgba(221, 186, 255, 0.4) 100%
            );
        }
        
        /* Smooth section backgrounds - seamless transitions */
        .section-gradient-1 { 
            background: linear-gradient(180deg, 
                rgba(255, 182, 193, 0.3) 0%,
                rgba(255, 200, 189, 0.3) 50%,
                rgba(255, 218, 185, 0.3) 100%
            ); 
        }
        .section-gradient-2 { 
            background: linear-gradient(180deg, 
                rgba(255, 218, 185, 0.3) 0%,
                rgba(255, 236, 185, 0.3) 50%,
                rgba(255, 255, 186, 0.3) 100%
            ); 
        }
        .section-gradient-3 { 
            background: linear-gradient(180deg, 
                rgba(255, 255, 186, 0.3) 0%,
                rgba(220, 255, 193, 0.3) 50%,
                rgba(186, 255, 201, 0.3) 100%
            ); 
        }
        .section-gradient-4 { 
            background: linear-gradient(180deg, 
                rgba(186, 255, 201, 0.3) 0%,
                rgba(186, 240, 228, 0.3) 50%,
                rgba(186, 225, 255, 0.3) 100%
            ); 
        }
        .section-gradient-5 { 
            background: linear-gradient(180deg, 
                rgba(186, 225, 255, 0.3) 0%,
                rgba(203, 205, 255, 0.3) 50%,
                rgba(221, 186, 255, 0.3) 100%
            ); 
        }
        .section-gradient-6 { 
            background: linear-gradient(180deg, 
                rgba(221, 186, 255, 0.3) 0%,
                rgba(240, 190, 230, 0.3) 50%,
                rgba(255, 182, 193, 0.3) 100%
            ); 
        }
        
        /* Page background wrapper - smooth gradient flow */
        .page-background {
            position: relative;
            min-height: 100vh;
            background: linear-gradient(180deg, 
                rgba(255, 182, 193, 0.3) 0%,
                rgba(255, 200, 189, 0.3) 8%,
                rgba(255, 218, 185, 0.3) 16%,
                rgba(255, 236, 185, 0.3) 24%,
                rgba(255, 255, 186, 0.3) 32%,
                rgba(220, 255, 193, 0.3) 40%,
                rgba(186, 255, 201, 0.3) 48%,
                rgba(186, 240, 228, 0.3) 56%,
                rgba(186, 225, 255, 0.3) 64%,
                rgba(203, 205, 255, 0.3) 72%,
                rgba(221, 186, 255, 0.3) 80%,
                rgba(240, 190, 230, 0.3) 88%,
                rgba(255, 182, 193, 0.3) 100%
            );
        }


        /* Ensure sections blend seamlessly - transparent so background shows through */
        section[class*="section-gradient"] {
            margin-top: 0 !important;
            margin-bottom: 0 !important;
            position: relative;
            background: transparent !important;
        }
        
        section[class*="section-gradient"] + section[class*="section-gradient"] {
            margin-top: -1px;
        }

        /* Page sections - transparent background so page-background shows through */
        .page-background section {
            background: transparent !important;
            position: relative;
        }

        /* Ensure smooth transitions between sections */
        .page-background section + section {
            margin-top: 0;
        }
        
        /* Background layers for future images */
        .bg-layer-skate { background: linear-gradient(180deg, rgba(255, 182, 193, 0.15) 0%, rgba(255, 200, 189, 0.15) 100%); }
        .bg-layer-football { background: linear-gradient(180deg, rgba(255, 200, 189, 0.15) 0%, rgba(255, 218, 185, 0.15) 100%); }
        .bg-layer-basketball { background: linear-gradient(180deg, rgba(255, 218, 185, 0.15) 0%, rgba(255, 255, 186, 0.15) 100%); }
        .bg-layer-bar { background: linear-gradient(180deg, rgba(255, 255, 186, 0.15) 0%, rgba(186, 255, 201, 0.15) 100%); }
        .bg-layer-freerun { background: linear-gradient(180deg, rgba(186, 255, 201, 0.15) 0%, rgba(186, 225, 255, 0.15) 100%); }
        .bg-layer-community { background: linear-gradient(180deg, rgba(186, 225, 255, 0.15) 0%, rgba(221, 186, 255, 0.15) 100%); }
        
        /* Floating elements */
        .floating-gif {
            width: 180px;
            height: 180px;
            opacity: 0.7;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            margin-left: -120px;
            margin-top: -40px;
        }
        
        .floating-gif:hover {
            transform: scale(1.05);
            opacity: 0.9;
        }
        
        @media (max-width: 768px) {
            .floating-gif {
                width: 120px;
                height: 120px;
                margin-left: -60px;
                margin-top: -20px;
            }
        }
        
        /* Organic logo shapes */
        .organic-shape {
            border-radius: 63% 37% 54% 46% / 55% 48% 52% 45%;
            animation: morphShape 8s ease-in-out infinite;
        }
        
        @keyframes morphShape {
            0%, 100% {
                border-radius: 63% 37% 54% 46% / 55% 48% 52% 45%;
            }
            25% {
                border-radius: 40% 60% 70% 30% / 40% 40% 60% 60%;
            }
            50% {
                border-radius: 54% 46% 38% 62% / 49% 70% 30% 51%;
            }
            75% {
                border-radius: 31% 69% 60% 40% / 70% 50% 50% 30%;
            }
        }
        
        /* Hamburger Button */
        .hamburger-btn {
            position: fixed;
            top: 1.5rem;
            left: 1.5rem;
            z-index: 10001;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(8px);
        }
        
        /* Social Icons - Force right position */
        .social-icons-fixed {
            position: fixed !important;
            right: 0.75rem !important;
            top: 1.5rem !important;
            left: auto !important;
            transform: none !important;
            margin: 0 !important;
        }

        /* Sidebar Overlay */
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            cursor: pointer;
        }

        .sidebar-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 280px;
            max-width: 85vw;
            height: 100vh;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            box-shadow: 2px 0 20px rgba(0, 0, 0, 0.15);
            z-index: 10000;
            transform: translateX(-100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
            overflow-x: hidden;
        }

        .sidebar.open {
            transform: translateX(0);
        }

        .sidebar-content {
            display: flex;
            flex-direction: column;
            height: 100%;
            padding: 1.5rem;
            padding-top: 5rem;
        }

        .sidebar-header {
            margin-bottom: 1rem;
        }

        .sidebar-nav {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .sidebar-auth {
            margin-top: auto;
        }

        .sidebar-link {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            color: #374151;
            font-weight: 500;
            transition: all 0.2s ease;
            text-decoration: none;
            width: 100%;
        }

        .sidebar-link:hover {
            background-color: #f3f4f6;
            color: #6366f1;
        }

        .sidebar-link.active {
            background-color: #eef2ff;
            color: #6366f1;
        }

        .sidebar-link svg {
            flex-shrink: 0;
        }

        .sidebar-link span {
            flex: 1;
        }

        /* Nav link styles */
        .nav-link {
            position: relative;
            transition: color 0.3s ease;
        }
        
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 10001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            z-index: 10002;
            pointer-events: auto;
            /* Ensure all interactive elements are clickable */
        }
        
        /* Ensure file inputs and other form elements are clickable */
        .modal-content input[type="file"],
        .modal-content input[type="text"],
        .modal-content input[type="url"],
        .modal-content select,
        .modal-content textarea,
        .modal-content button {
            pointer-events: auto;
            position: relative;
            z-index: 10003;
        }
    </style>
</head>
<body class="overflow-x-hidden">
    <!-- Parallax Container (only for home page) -->
    <div id="parallax-container" class="fixed inset-0 pointer-events-none" style="display: none;">
        <!-- Background Layers -->
        <div class="parallax-layer" data-speed="0.1" style="background-image: url('/public/asVanDeBrug.jpg'); background-size: cover; background-position: center; opacity: 0.3;"></div>
        <div class="parallax-layer bg-layer-skate" data-speed="0.2"></div>
        <div class="parallax-layer bg-layer-football" data-speed="0.3"></div>
        <div class="parallax-layer bg-layer-basketball" data-speed="0.4"></div>
        <div class="parallax-layer bg-layer-bar" data-speed="0.5"></div>
        <div class="parallax-layer bg-layer-freerun" data-speed="0.6"></div>
        <div class="parallax-layer bg-layer-community" data-speed="0.7"></div>
    </div>

    <!-- Main Content Area -->
    <div id="main-content" class="relative z-10">
        <!-- Pages will be loaded here -->
    </div>

    <!-- Login Modal -->
    <div id="login-modal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-800">Inloggen</h2>
                <button onclick="document.getElementById('login-modal').classList.remove('active')" class="text-gray-500 hover:text-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div id="login-tab" class="tab-content">
                <form id="login-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <input type="email" id="login-email" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Wachtwoord</label>
                        <div class="relative">
                            <input type="password" id="login-password" required class="w-full px-4 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                            <button type="button" onclick="togglePasswordVisibility('login-password', 'login-password-toggle')" id="login-password-toggle" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 focus:outline-none">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" id="login-password-toggle-icon">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <button type="submit" class="w-full bg-pink-500 text-white py-2 rounded-lg hover:bg-pink-600 transition-colors font-medium">
                        Inloggen
                    </button>
                </form>
                <div class="mt-4 text-center">
                    <p class="text-sm text-gray-600">
                        Nog geen account? 
                        <button onclick="showSignUp()" class="text-pink-600 hover:text-pink-700 font-medium">Registreer hier</button>
                    </p>
                </div>
            </div>
            <div id="signup-tab" class="tab-content hidden">
                <form id="signup-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Naam</label>
                        <input type="text" id="signup-name" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <input type="email" id="signup-email" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Wachtwoord</label>
                        <div class="relative">
                            <input type="password" id="signup-password" required class="w-full px-4 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-pink-500 focus:border-transparent">
                            <button type="button" onclick="togglePasswordVisibility('signup-password', 'signup-password-toggle')" id="signup-password-toggle" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 focus:outline-none">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" id="signup-password-toggle-icon">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <button type="submit" class="w-full bg-pink-500 text-white py-2 rounded-lg hover:bg-pink-600 transition-colors font-medium">
                        Registreren
                    </button>
                </form>
                <div class="mt-4 text-center">
                    <p class="text-sm text-gray-600">
                        Al een account? 
                        <button onclick="showLogin()" class="text-pink-600 hover:text-pink-700 font-medium">Log hier in</button>
                    </p>
                </div>
            </div>
            <div id="login-error" class="mt-4 p-3 bg-red-100 text-red-700 rounded-lg hidden"></div>
            <div id="login-success" class="mt-4 p-3 bg-green-100 text-green-700 rounded-lg hidden"></div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Load Supabase modules first -->
    <script src="/js/supabase-config.js"></script>
    <script src="/js/database.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/router.js"></script>
    <script src="/js/navigation.js"></script>
    
    <script>
        // Initialize GSAP ScrollTrigger
        gsap.registerPlugin(ScrollTrigger);

        // Parallax effect for background layers (only on home page)
        function initParallax() {
            const parallaxContainer = document.getElementById('parallax-container');
            const currentPath = window.location.pathname || '/';
            if (parallaxContainer && (currentPath === '/' || currentPath === '/home')) {
                parallaxContainer.style.display = 'block';
                
                gsap.utils.toArray('.parallax-layer').forEach((layer) => {
                    const speed = layer.dataset.speed || 0.5;
                    gsap.to(layer, {
                        yPercent: -50 * speed,
                        ease: "none",
                        scrollTrigger: {
                            trigger: layer,
                            start: "top bottom",
                            end: "bottom top",
                            scrub: true
                        }
                    });
                });
            } else {
                if (parallaxContainer) parallaxContainer.style.display = 'none';
            }
        }

        // Smooth scrolling for anchor links
        document.addEventListener('click', function(e) {
            const link = e.target.closest('a[href^="#"]');
            if (link) {
                const href = link.getAttribute('href');
                // Skip if it's a route link (starts with /) - router handles those
                if (href.startsWith('/')) {
                    return;
                }
                // Handle anchor links within pages (like #section-id)
                e.preventDefault();
                const target = document.querySelector(href);
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            }
        });

        // Card hover animations
        function initCardHovers() {
            gsap.utils.toArray('.card-hover').forEach(card => {
                const tl = gsap.timeline({ paused: true });
                tl.to(card, { y: -8, boxShadow: "0 20px 40px rgba(0,0,0,0.15)", duration: 0.3 });
                
                card.addEventListener('mouseenter', () => tl.play());
                card.addEventListener('mouseleave', () => tl.reverse());
            });
        }

        // Fade in animations for sections
        function initSectionAnimations() {
            gsap.utils.toArray('section').forEach(section => {
                gsap.from(section.children, {
                    y: 50,
                    opacity: 0,
                    duration: 1,
                    stagger: 0.1,
                    scrollTrigger: {
                        trigger: section,
                        start: "top 80%",
                        end: "bottom 20%",
                        toggleActions: "play none none reverse"
                    }
                });
            });
        }

        // Floating GIF animation
        function initFloatingGif() {
            const floatingGif = document.getElementById('floating-gif');
            if (floatingGif) {
                gsap.to(floatingGif, {
                    y: 20,
                    rotation: 3,
                    duration: 3,
                    repeat: -1,
                    yoyo: true,
                    ease: "power2.inOut"
                });
            }
        }

        // Force video autoplay on user interaction
        function initHeroVideo() {
            const heroVideo = document.getElementById('hero-video');
            if (heroVideo) {
                // Lazy load video on first user interaction
                const loadVideo = () => {
                    if (heroVideo.readyState === 0) {
                        heroVideo.load(); // Load video source
                    }
                    heroVideo.play().catch(() => {}); // Silent fail for autoplay
                };
                
                heroVideo.addEventListener('loadeddata', () => {
                    heroVideo.style.display = 'block';
                });
                
                heroVideo.addEventListener('error', () => {
                    heroVideo.style.display = 'none';
                });

                // Load video on user interaction (lazy loading)
                document.addEventListener('click', loadVideo, { once: true });
                document.addEventListener('touchstart', loadVideo, { once: true });
                document.addEventListener('scroll', loadVideo, { once: true });
            }
        }

        // Login/Profile Modal Functions
        function showSignUp() {
            document.getElementById('login-tab').classList.add('hidden');
            document.getElementById('signup-tab').classList.remove('hidden');
            document.getElementById('login-error').classList.add('hidden');
            document.getElementById('login-success').classList.add('hidden');
        }

        function showLogin() {
            document.getElementById('signup-tab').classList.add('hidden');
            document.getElementById('login-tab').classList.remove('hidden');
            document.getElementById('login-error').classList.add('hidden');
            document.getElementById('login-success').classList.add('hidden');
        }

        // Toggle password visibility
        function togglePasswordVisibility(passwordId, toggleId) {
            const passwordInput = document.getElementById(passwordId);
            const toggleIcon = document.getElementById(toggleId + '-icon');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                // Change icon to eye-slash (hidden)
                toggleIcon.innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.29 3.29m0 0L9.88 9.88m-3.59-3.59l3.29 3.29M12 12l.01.01M12 12l-.01-.01m0 0L9.88 9.88m0 0L6.59 6.59"></path>
                `;
            } else {
                passwordInput.type = 'password';
                // Change icon back to eye (visible)
                toggleIcon.innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                `;
            }
        }

        // Login Form Handler
        document.getElementById('login-form')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            const errorDiv = document.getElementById('login-error');
            const successDiv = document.getElementById('login-success');

            try {
                await window.authManager.signIn(email, password);
                successDiv.textContent = 'Succesvol ingelogd!';
                successDiv.classList.remove('hidden');
                errorDiv.classList.add('hidden');
                setTimeout(() => {
                    document.getElementById('login-modal').classList.remove('active');
                    if (window.navigation) window.navigation.updateAuthButtons();
                }, 1500);
            } catch (error) {
                errorDiv.textContent = error.message || 'Inloggen mislukt. Probeer opnieuw.';
                errorDiv.classList.remove('hidden');
                successDiv.classList.add('hidden');
            }
        });

        // Signup Form Handler
        document.getElementById('signup-form')?.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const fullName = document.getElementById('signup-name').value;
            const errorDiv = document.getElementById('login-error');
            const successDiv = document.getElementById('login-success');

            try {
                await window.authManager.signUp(email, password, fullName);
                successDiv.textContent = 'Account aangemaakt! Check je email voor verificatie.';
                successDiv.classList.remove('hidden');
                errorDiv.classList.add('hidden');
            } catch (error) {
                errorDiv.textContent = error.message || 'Registratie mislukt. Probeer opnieuw.';
                errorDiv.classList.remove('hidden');
                successDiv.classList.add('hidden');
            }
        });

        // Sign Out Handler
        async function handleSignOut() {
            try {
                await window.authManager.signOut();
                if (window.navigation) window.navigation.updateAuthButtons();
                const currentPath = window.location.pathname || '/';
                if (currentPath === '/profiel' || currentPath.startsWith('/beheer')) {
                    if (window.router) {
                        window.router.navigate('/');
                    } else {
                        window.location.pathname = '/';
                    }
                }
            } catch (error) {
                console.error('Logout failed:', error.message);
            }
        }

        // Wait for database manager to be ready
        async function waitForDbManager(maxAttempts = 50) {
            let attempts = 0;
            while (attempts < maxAttempts) {
                if (window.dbManager && window.dbManager.supabase && window.supabaseClient) {
                    return true;
                }
                await new Promise(resolve => setTimeout(resolve, 100));
                attempts++;
            }
            return false;
        }

        // Load data from database
        window.isLoadingData = false;
        window.loadData = async function loadData() {
            // Prevent multiple simultaneous calls
            if (window.isLoadingData) {
                return;
            }

            // Wait for database manager if not ready
            if (!window.supabaseClient || !window.dbManager || !window.dbManager.supabase) {
                const dbReady = await waitForDbManager();
                if (!dbReady) {
                    setTimeout(window.loadData, 500);
                    return;
                }
            }

            window.isLoadingData = true;
            
            try {
                // Load evenementen (large events)
                try {
                    const evenementen = await window.dbManager.getEvenementen();
                    
                    const evenementenContainer = document.getElementById('evenementen-container');
                    const agendaContainer = document.getElementById('agenda-container');
                    
                    if (evenementen && evenementen.length > 0) {
                        const agendaHTML = evenementen.map(item => {
                            const startDate = new Date(item.start_datetime);
                            const endDate = item.end_datetime ? new Date(item.end_datetime) : null;
                            const isCorrigirls = item.for_girls;
                            return `
                                <div class="bg-white/60 backdrop-blur-sm rounded-3xl p-6 card-hover ${isCorrigirls ? 'border-l-4 border-pink-500' : ''}">
                                    <div class="flex items-start justify-between mb-2">
                                        <h3 class="text-xl font-bold text-gray-800">${item.title}</h3>
                                        <div class="flex gap-2">
                                            <span class="px-2 py-1 bg-purple-100 text-purple-700 rounded-full text-xs font-medium whitespace-nowrap">Evenement</span>
                                            ${isCorrigirls ? '<span class="px-2 py-1 bg-pink-100 text-pink-700 rounded-full text-xs font-medium whitespace-nowrap">Corrigirls</span>' : ''}
                                        </div>
                                    </div>
                                    ${item.description ? `<p class="text-gray-700 text-sm mb-2">${item.description}</p>` : ''}
                                    <div class="flex items-center gap-4 text-xs text-gray-600">
                                        <span>üìÖ ${startDate.toLocaleDateString('nl-NL')}</span>
                                        <span>üïê ${startDate.toLocaleTimeString('nl-NL', { hour: '2-digit', minute: '2-digit' })}${endDate ? ` - ${endDate.toLocaleTimeString('nl-NL', { hour: '2-digit', minute: '2-digit' })}` : ''}</span>
                                        ${item.zones ? `<span>üìç ${item.zones.name}</span>` : ''}
                                    </div>
                                </div>
                            `;
                        }).join('');
                        
                        if (evenementenContainer) evenementenContainer.innerHTML = agendaHTML;
                        // Don't override agenda container as it has its own calendar view
                    }
                } catch (error) {
                    // Silent fail for agenda items
                }

                // Load Corristories
                try {
                    const corristories = await window.dbManager.getCorristories();
                    const corristoriesContainer = document.getElementById('corristories-container');
                    if (corristoriesContainer && corristories && corristories.length > 0) {
                        corristoriesContainer.innerHTML = corristories.map(story => `
                            <div class="bg-white/60 backdrop-blur-sm rounded-3xl p-6 card-hover">
                                <h3 class="text-xl font-bold text-gray-800 mb-2">${story.title}</h3>
                                <p class="text-gray-700 mb-2">${story.content}</p>
                                <p class="text-gray-600 text-sm">Door: ${story.author_name || 'Anoniem'}</p>
                            </div>
                        `).join('');
                    }
                } catch (error) {
                    // Silent fail for corristories
                }

                // Load zones
                try {
                    const zones = await window.dbManager.getZones();
                    const zonesContainer = document.getElementById('zones-container');
                    if (zonesContainer && zones && zones.length > 0) {
                        zonesContainer.innerHTML = zones.map(zone => `
                            <div class="bg-white/60 backdrop-blur-sm rounded-3xl p-6 card-hover">
                                <div class="w-12 h-12 mx-auto mb-4 text-gray-600">
                                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                    </svg>
                                </div>
                                <h3 class="text-2xl font-bold text-gray-800 mb-3 text-center">Zone ${zone.zone_number}: ${zone.name}</h3>
                                <p class="text-gray-700 text-center">${zone.description || ''}</p>
                            </div>
                        `).join('');
                    }
                } catch (error) {
                    // Silent fail for zones
                }
console.log('Container and video found! Loading animation from storage...');
                                     
                                     // Clear any existing sources (remove old hardcoded video if any)
                                     animationVideo.innerHTML = '';
                                     
                                     // Create new source element with storage URL
                                     const source = document.createElement('source');
                                     source.src = publicUrl;
                                     source.type = 'video/mp4';
                                     animationVideo.appendChild(source);
                                     
                                     // Show the container (remove hidden class)
                                     animationContainer.classList.remove('hidden');
                                     console.log('Container shown, hidden class removed');
                                     
                // Load intro animation from storage
                try {
                    if (window.supabaseClient) {
                        console.log('Loading animation from storage...');

                        // First test if we can access the bucket at all
                        const { data: testData, error: testError } = await window.supabaseClient.storage
                            .from('intro-animations')
                            .list('', { limit: 1 });

                        if (testError) {
                            console.error('Cannot access intro-animations bucket:', testError);
                            return;
                        }

                        console.log('Bucket access successful, found files:', testData);

                        const { data: files, error } = await window.supabaseClient.storage
                            .from('intro-animations')
                            .list('', {
                                limit: 1,
                                sortBy: { column: 'created_at', order: 'desc' }
                            });

                        console.log('Storage list result:', { files, error });

                        if (error) {
                            console.error('Error listing files:', error);
                            console.error('Error details:', error.message, error.details);
                        } else if (files && files.length > 0) {
                            const fileName = files[0].name;
                            console.log('Found animation file:', fileName);

                            const { data: { publicUrl } } = window.supabaseClient.storage
                                .from('intro-animations')
                                .getPublicUrl(fileName);

                            console.log('Generated Public URL:', publicUrl);

                             // Wait for DOM elements to be available (retry mechanism)
                             // The router loads HTML asynchronously, so elements might not be ready yet
                             let attempts = 0;
                             const maxAttempts = 50; // Try for 5 seconds (more time for router to load)
                             
                             const loadAnimationIntoDOM = () => {
                                 // Try to find elements - check both in main content and in loaded page
                                 const mainContent = document.getElementById('main-content');
                                 let animationContainer = document.getElementById('animation-container');
                                 let animationVideo = document.getElementById('intro-animation');

                                 console.log('Looking for animation elements...');
                                 console.log('mainContent found:', !!mainContent);
                                 console.log('animationContainer found directly:', !!animationContainer);
                                 console.log('animationVideo found directly:', !!animationVideo);

                                 // If not found in main document, try searching in main-content
                                 if (!animationContainer && mainContent) {
                                     animationContainer = mainContent.querySelector('#animation-container');
                                     console.log('animationContainer found in mainContent:', !!animationContainer);
                                 }
                                 if (!animationVideo && mainContent) {
                                     animationVideo = mainContent.querySelector('#intro-animation');
                                     console.log('animationVideo found in mainContent:', !!animationVideo);
                                 }

                                 console.log('Final elements found:', {
                                     animationContainer: !!animationContainer,
                                     animationVideo: !!animationVideo
                                 });

                                 if (animationContainer && animationVideo) {
                                     
                                     // Load and play the video
                                     animationVideo.load();
                                     
                                     // Wait for video to load, then play
                                     animationVideo.addEventListener('loadeddata', () => {
                                         console.log('Video data loaded from storage, attempting to play');
                                         animationVideo.play().catch(err => {
                                             console.log('Autoplay prevented, user interaction required:', err);
                                         });
                                     }, { once: true });
                                     
                                     // Also try to play immediately (might fail due to autoplay policy)
                                     animationVideo.play().catch(err => {
                                         console.log('Immediate play failed (expected), will retry after load:', err);
                                     });
                                     
                                     console.log('Animation loaded from storage:', publicUrl);
                                     return true; // Success
                                 } else {
                                     attempts++;
                                     if (attempts < maxAttempts) {
                                         if (attempts % 5 === 0) { // Log every 5th attempt to reduce spam
                                             console.log(`Elements not found yet, retrying... (${attempts}/${maxAttempts})`);
                                         }
                                         setTimeout(loadAnimationIntoDOM, 100);
                                     } else {
                                         console.error('Animation container or video element not found after', maxAttempts, 'attempts!');
                                         console.error('Searched in:', {
                                             mainDocument: !!document.getElementById('animation-container'),
                                             mainContent: mainContent ? !!mainContent.querySelector('#animation-container') : 'main-content not found'
                                         });
                                     }
                                     return false; // Not ready yet
                                 }
                             };
                             
                             // Start trying to load the animation
                             console.log('Starting animation load attempt...');
                             loadAnimationIntoDOM();

                             // If elements not found initially, try again after a short delay
                             setTimeout(() => {
                                 const mainContent = document.getElementById('main-content');
                                 const animationContainer = mainContent ? mainContent.querySelector('#animation-container') : null;
                                 const animationVideo = mainContent ? mainContent.querySelector('#intro-animation') : null;

                                 if (!animationContainer || !animationVideo) {
                                     console.log('Elements still not found after initial attempt, trying again...');
                                     loadAnimationIntoDOM();
                                 }
                             }, 1000);
                        } else {
                            console.log('No animation files found in storage');
                            // Fallback: try to load directly by filename if we know it exists
                            console.log('Trying fallback: loading intro-animation.mp4 directly');
                            const fallbackUrl = 'https://vwbrvxkzjwpppagkpipf.supabase.co/storage/v1/object/public/intro-animations/intro-animation.mp4';
                            console.log('Fallback URL:', fallbackUrl);

                            // Try to load with fallback URL
                            const loadAnimationIntoDOMFallback = () => {
                                const mainContent = document.getElementById('main-content');
                                let animationContainer = mainContent ? mainContent.querySelector('#animation-container') : null;
                                let animationVideo = mainContent ? mainContent.querySelector('#intro-animation') : null;

                                if (animationContainer && animationVideo) {
                                    console.log('Loading video with fallback URL...');
                                    animationVideo.innerHTML = `<source src="${fallbackUrl}" type="video/mp4">`;
                                    animationVideo.load();

                                    animationVideo.addEventListener('loadeddata', () => {
                                        console.log('Fallback video loaded successfully!');
                                        animationContainer.classList.remove('hidden');
                                    }, { once: true });

                                    animationVideo.addEventListener('error', (e) => {
                                        console.error('Fallback video failed to load:', e);
                                    }, { once: true });
                                } else {
                                    console.log('Elements not found for fallback, retrying...');
                                    setTimeout(loadAnimationIntoDOMFallback, 500);
                                }
                            };

                            loadAnimationIntoDOMFallback();
                        }
                    } else {
                        console.log('Supabase client not available');
                    }
                } catch (error) {
                    console.error('Error loading animation from storage:', error);
                    // Silent fail for animation - bucket might not exist yet
                }
            } catch (error) {
                console.error('Error loading data:', error.message);
            } finally {
                window.isLoadingData = false;
            }
        }

        // Initialize page after route loads
        function initializePage() {
            initParallax();
            initCardHovers();
            initSectionAnimations();
            initFloatingGif();
            initHeroVideo();

            // Only load data for homepage
            if (window.location.pathname === '/' || window.location.pathname === '/home') {
                // Wait a bit longer for Supabase to be ready and page to be fully loaded
                setTimeout(() => {
                    console.log('Initializing page data loading for homepage...');
                    loadData();
                }, 3000); // Increased delay
            }

            ScrollTrigger.refresh();
        }

        // Listen for route changes - reload data when returning to homepage
        // Use popstate for History API navigation
        window.addEventListener('popstate', () => {
            const route = window.location.pathname || '/';
            // Reload data when navigating to homepage
            if (route === '/' || route === '/home') {
                // Reset loading flag to allow reload
                if (window.isLoadingData !== undefined) {
                    window.isLoadingData = false;
                }
                // Wait a bit for page to load, then reload data
                setTimeout(() => {
                    if (window.loadData) {
                        window.loadData();
                    }
                }, 300);
            }
            setTimeout(initializePage, 100);
        });
        
        // Also listen for custom route change events from router
        window.addEventListener('routechange', () => {
            const route = window.location.pathname || '/';
            if (route === '/' || route === '/home') {
                if (window.isLoadingData !== undefined) {
                    window.isLoadingData = false;
                }
                setTimeout(() => {
                    if (window.loadData) {
                        window.loadData();
                    }
                }, 300);
            }
            setTimeout(initializePage, 100);
        });

        // Initial initialization
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(initializePage, 500);
            });
        } else {
            setTimeout(initializePage, 500);
        }

        // Update navigation when auth state changes
        if (window.authManager) {
            const originalUpdateUI = window.authManager.updateUI;
            window.authManager.updateUI = function() {
                if (originalUpdateUI) originalUpdateUI.call(this);
                if (window.navigation) window.navigation.updateAuthButtons();
            };
        }
    </script>
</body>
</html>
